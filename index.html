<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>VIX</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>

    <style>
      body {
        margin: 0;
        overflow: hidden;
      }
    </style>
  </head>
  <style>
    * {
      box-sizing: border-box;
    }
    :root {
      --primary: #d02f82;
      --secondary: #1e7efa;
    }
    body {
      background-color: #000;
      color: #fff;
    }
    h1 {
      margin: 10vw 0 0 0;
      padding: 0;
      font-size: 32px;
      font-family: monospace;
      background: -webkit-linear-gradient(
        45deg,
        var(--primary) -30%,
        var(--secondary) 110%
      );
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      filter: brightness(1.2);
      font-weight: 700;
      letter-spacing: -0.5px;
      line-height: 1.2;
    }
    .header {
      text-align: center;
      padding: 20px;
    }
    .container {
      display: flex;
      flex-direction: column;
      gap: 10px;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      max-height: 80vh;
      overflow: hidden;
    }
    @media (min-width: 768px) {
      .container {
        flex-direction: row;
      }
    }
    .input-column {
      display: flex;
      flex-direction: column;
      gap: 10px;
      flex-basis: 50%;
      flex-shrink: 0;
    }
    .input-column input,
    .input-column textarea {
      width: 100%;
      padding: 10px;
      background-color: #1a1a1a;
      border: 1px solid #333;
      color: #fff;
      font-family: monospace;
      font-size: 14px;
      line-height: 1.5;
      border-radius: 4px;
      transition: all 0.2s ease;
      outline: none;
      resize: none;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .input-column input:focus,
    .input-column textarea:focus {
      border-color: #666;
      box-shadow: 0 0 0 2px rgba(100, 100, 100, 0.3);
      background-color: #222;
    }
    .input-column textarea {
      height: 200px;
    }

    .output-column {
      flex-basis: 50%;
      flex-shrink: 0;
      flex-grow: 0;
      display: grid;
      position: relative;
      max-height: 90vh;
      overflow: auto;
    }
    #encrypted {
      padding: 10px;
      background-color: #0f0f0f;
      height: 100%;
      margin: 0;
      font-family: monospace;
      font-size: 14px;
      line-height: 1.5;
      overflow: auto;
      min-height: 200px;
      max-height: 90vh;
      border: 1px solid #333;
      border-radius: 4px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }
    #encrypted.success {
      color: #8bc34a;
      border: 1px solid #8bc34a;
    }
    #encrypted.failed {
      color: #f44336;
      border: 1px solid #f44336;
    }
    pre {
      margin: 0;
      padding: 0;
      font-family: monospace;
      max-width: 100%;
    }
    .copyright {
      position: fixed;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      font-family: "Helvetica Neue", Arial, sans-serif;
      font-size: 13px;
      color: #494949;
      padding: 8px 16px;
      transition: all 0.3s ease;
      width: 100%;
      text-align: center;
    }
    .copyright a {
      color: inherit;
      text-decoration: none;
    }
    .copyright:hover {
      color: #fff;
    }
    ::selection {
      background-color: #f6ff00;
      color: #000;
    }

    /* For Firefox */
    ::-moz-selection {
      background-color: #f6ff00;
      color: #000;
    }

    /* Make the encrypted output selection match */
    #encrypted::selection {
      background-color: #f6ff00;
      color: #000;
    }

    #encrypted::-moz-selection {
      background-color: #f6ff00;
      color: #000;
    }

    .copy-button {
      position: absolute;
      top: 8px;
      right: 8px;
      padding: 4px 8px;
      background: #333;
      border: 1px solid #444;
      border-radius: 4px;
      color: #fff;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease, background 0.2s ease;
    }

    .copy-button:hover {
      background: #444;
    }

    .copy-button.success {
      background: #8bc34a;
      border-color: #7cb342;
    }
  </style>
  <body>
    <div class="header">
      <h1>Phonebook Encrypt</h1>
    </div>
    <div class="container">
      <div class="input-column">
        <textarea
          id="text"
          placeholder="Enter text to encrypt or decrypt..."
        ></textarea>
        <input
          type="text"
          id="key"
          placeholder="Enter encryption key (optional)..."
        />
      </div>

      <div class="output-column">
        <button class="copy-button" id="copyButton">Copy</button>
        <pre
          id="encrypted"
        ><span style="opacity: 0.3;">Enter text to see result</span></pre>
      </div>
    </div>

    <p class="copyright">
      Made with ❤️ by Alexander L&ouml;hn - 2024 -
      <a href="https://loehx.com/" target="_blank">loehx.com</a>
    </p>

    <script>
      const elements = {
        key: document.getElementById("key"),
        text: document.getElementById("text"),
        encrypted: document.getElementById("encrypted"),
        copyButton: document.querySelector(".copy-button"),
      };

      elements.text.addEventListener("input", update);
      elements.key.addEventListener("input", update);

      // Add click handler to select encrypted text
      elements.encrypted.addEventListener("click", function () {
        const range = document.createRange();
        range.selectNodeContents(this);
        const selection = window.getSelection();
        selection.removeAllRanges();
        selection.addRange(range);
      });

      const copyButton = document.getElementById("copyButton");

      copyButton.addEventListener("click", async () => {
        try {
          await navigator.clipboard.writeText(elements.encrypted.textContent);
          copyButton.textContent = "Copied!";
          copyButton.classList.add("success");
          setTimeout(() => {
            copyButton.textContent = "Copy";
            copyButton.classList.remove("success");
          }, 2000);
        } catch (err) {
          console.error("Failed to copy text:", err);
        }
      });

      function update() {
        const key = elements.key.value;
        const text = elements.text.value.trim().replace(/^\n+|\n+$/g, "");

        if (isEncrypted(text)) {
          const decrypted = decrypt(text, key);
          elements.encrypted.classList.toggle("success", decrypted);
          elements.encrypted.classList.toggle("failed", !decrypted);
          if (decrypted) {
            elements.encrypted.textContent = decrypted;
            showCopyButton();
          } else {
            elements.encrypted.textContent = "Failed to decrypt";
            hideCopyButton();
          }
        } else {
          elements.encrypted.classList.remove("success", "failed");
          const encryptedText = encrypt(text, key);
          elements.encrypted.textContent = encryptedText;
          text ? showCopyButton() : hideCopyButton();
        }
      }

      function isEncrypted(text) {
        const lineCount = text.split("\n").length;
        const plusCount = text.split("+").length - 1;
        const colonCount = text.split(":").length - 1;
        return (
          plusCount > 0 && lineCount === plusCount && lineCount === colonCount
        );
      }

      function encrypt(text, key) {
        const DEFAULT_HASH = 137; // A prime number as default hash
        const keyHash = key
          ? key
              .split("")
              .map((char) => char.charCodeAt(0))
              .reduce((sum, ascii) => sum + ascii, 0) % 500
          : DEFAULT_HASH;

        const chars = text.split("");
        const ascii = chars.map((char) => char.charCodeAt(0));

        const encrypted = ascii
          .map((ascii, index) => {
            const hash = keyHash + (index % 256);
            return (ascii + hash + index).toString(10).padStart(3, "0");
          })
          .join("");

        const chunks = encrypted.match(/.{1,8}/g) || [];
        const checksum = ascii.reduce((sum, code) => sum + code, 0) % 100;
        return chunks
          .map((chunk, index) => {
            const randomName = getRandomName();
            const areaCode = Math.floor(Math.random() * 90) + 10; // Random 2-digit area code
            const separator = Math.random() < 0.5 ? " - " : " ";
            let formattedChunk = chunk.slice(0, 4) + separator + chunk.slice(4);

            // Add checksum to the last phone number
            if (index === chunks.length - 1) {
              formattedChunk += checksum.toString().padStart(3, "0");
            }

            return `${randomName}: +${areaCode} ${formattedChunk}`;
          })
          .join("\n");
      }

      function decrypt(text, key) {
        if (!text.includes(":") || !text.includes("+")) return "";

        const DEFAULT_HASH = 137;
        const keyHash = key
          ? key
              .split("")
              .map((char) => char.charCodeAt(0))
              .reduce((sum, ascii) => sum + ascii, 0) % 500
          : DEFAULT_HASH;

        const chunks = text.split("\n");

        const decrypted = chunks
          .map((chunk) => {
            if (!chunk.includes(":")) return "";
            const [name, phone] = chunk.split(":");
            const [areaCode, ...rest] = phone.trim().slice(1).split(" ");
            // Join the rest of the parts and remove any separators and the checksum from the last chunk
            let numbers = rest.join("").replace(/[-\s]/g, "");
            if (chunk === chunks[chunks.length - 1]) {
              numbers = numbers.slice(0, -3); // Remove last 3 digits (checksum)
            }
            return numbers;
          })
          .join("");

        const numbers = decrypted.match(/.{3}/g) || [];
        const decryptedChars = numbers.map((num, index) => {
          const hash = keyHash + (index % 256);
          return String.fromCharCode(parseInt(num) - hash - index);
        });

        // Calculate checksum from decrypted ASCII codes
        const calculatedChecksum =
          decryptedChars
            .map((char) => char.charCodeAt(0))
            .reduce((sum, code) => sum + code, 0) % 100;

        // Get checksum from last two digits of encrypted text
        const lastChunk = chunks[chunks.length - 1];
        const actualChecksum = parseInt(lastChunk.slice(-2));

        // Return empty string if checksums don't match
        if (calculatedChecksum !== actualChecksum) {
          return "";
        }

        const result = decryptedChars.join("");
        console.log("Final decrypted result:", result);
        return result;
      }

      function getRandomName() {
        const names = [
          "Aaron",
          "Abigail",
          "Adam",
          "Adrian",
          "Aiden",
          "Alan",
          "Albert",
          "Alex",
          "Alexander",
          "Alice",
          "Alicia",
          "Allison",
          "Amanda",
          "Amber",
          "Amy",
          "Andrea",
          "Andrew",
          "Angela",
          "Ann",
          "Anna",
          "Anthony",
          "Arthur",
          "Ashley",
          "Austin",
          "Barbara",
          "Benjamin",
          "Beth",
          "Betty",
          "Beverly",
          "Bill",
          "Billy",
          "Blake",
          "Bob",
          "Bobby",
          "Bradley",
          "Brandon",
          "Brenda",
          "Brian",
          "Brittany",
          "Bruce",
          "Bryan",
          "Caitlin",
          "Caleb",
          "Cameron",
          "Carl",
          "Carol",
          "Caroline",
          "Carolyn",
          "Catherine",
          "Charles",
          "Charlotte",
          "Chelsea",
          "Cheryl",
          "Christian",
          "Christina",
          "Christine",
          "Christopher",
          "Claire",
          "Cody",
          "Cole",
          "Connor",
          "Corey",
          "Courtney",
          "Craig",
          "Crystal",
          "Cynthia",
          "Dale",
          "Dan",
          "Daniel",
          "Danielle",
          "Danny",
          "David",
          "Dawn",
          "Dean",
          "Deborah",
          "Debra",
          "Denise",
          "Dennis",
          "Derek",
          "Diana",
          "Diane",
          "Donald",
          "Donna",
          "Dorothy",
          "Douglas",
          "Dylan",
          "Edward",
          "Elijah",
          "Elizabeth",
          "Emily",
          "Emma",
          "Eric",
          "Erica",
          "Erik",
          "Ethan",
          "Eugene",
          "Eva",
          "Evelyn",
          "Faith",
          "Frances",
          "Frank",
          "Gabriel",
          "Gary",
          "George",
          "Gerald",
          "Gloria",
          "Grace",
          "Gregory",
          "Hannah",
          "Harold",
          "Harry",
          "Heather",
          "Helen",
          "Henry",
          "Holly",
          "Howard",
          "Ian",
          "Isaac",
          "Jack",
          "Jackson",
          "Jacob",
          "Jacqueline",
          "James",
          "Jamie",
          "Jane",
          "Janet",
          "Janice",
          "Jason",
          "Jay",
          "Jean",
          "Jeff",
          "Jeffrey",
          "Jennifer",
          "Jeremy",
          "Jerry",
          "Jesse",
          "Jessica",
          "Jill",
          "Jim",
          "Jimmy",
          "Joan",
          "Joe",
          "John",
          "Johnny",
          "Jonathan",
          "Jordan",
          "Joseph",
          "Joshua",
          "Joyce",
          "Juan",
          "Judith",
          "Judy",
          "Julia",
          "Julie",
          "Justin",
          "Karen",
          "Katherine",
          "Kathleen",
          "Kathryn",
          "Kathy",
          "Keith",
          "Kelly",
          "Kenneth",
          "Kevin",
          "Kim",
          "Kimberly",
          "Kyle",
          "Larry",
          "Laura",
          "Lauren",
          "Lawrence",
          "Leah",
          "Leonard",
          "Leslie",
          "Linda",
          "Lisa",
          "Logan",
          "Lori",
          "Louis",
          "Lucas",
          "Luke",
          "Lynn",
          "Madison",
          "Margaret",
          "Maria",
          "Marie",
          "Marilyn",
          "Mark",
          "Martha",
          "Martin",
          "Mary",
          "Matthew",
          "Megan",
          "Melissa",
          "Michael",
          "Michelle",
          "Mike",
          "Nancy",
          "Natalie",
          "Nathan",
          "Nicholas",
          "Nicole",
          "Noah",
          "Norman",
          "Oliver",
          "Olivia",
          "Pamela",
          "Patricia",
          "Patrick",
          "Paul",
          "Paula",
          "Peter",
          "Philip",
          "Rachel",
          "Ralph",
          "Randy",
          "Raymond",
          "Rebecca",
          "Richard",
          "Robert",
          "Robin",
          "Roger",
          "Ronald",
          "Rose",
          "Roy",
          "Russell",
          "Ruth",
          "Ryan",
          "Samuel",
          "Sandra",
          "Sara",
          "Sarah",
          "Scott",
          "Sean",
          "Sharon",
          "Shawn",
          "Sheila",
          "Shirley",
          "Sophia",
          "Stephanie",
          "Stephen",
          "Steve",
          "Steven",
          "Susan",
          "Teresa",
          "Terry",
          "Theodore",
          "Thomas",
          "Timothy",
          "Tina",
          "Todd",
          "Tom",
          "Tony",
          "Tracy",
          "Tyler",
          "Victoria",
          "Vincent",
          "Virginia",
          "Walter",
          "Wayne",
          "William",
          "Willie",
          "Zachary",
        ];
        return names[Math.floor(Math.random() * names.length)];
      }

      function showCopyButton() {
        elements.copyButton.style.visibility = "visible";
        // Use setTimeout to ensure the visibility change is applied before opacity
        setTimeout(() => {
          elements.copyButton.style.opacity = "1";
        }, 10);
      }

      function hideCopyButton() {
        elements.copyButton.style.opacity = "0";
        // Wait for opacity transition to complete before hiding
        setTimeout(() => {
          elements.copyButton.style.visibility = "hidden";
        }, 300);
      }
    </script>
  </body>
</html>
